<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Application</title>
      <link href="assets/style.css" rel="stylesheet">
  </head>
  <body>
      <nav class="navbar navbar-default">
      <div class="container-fluid">
      <div class="page-header">
        <h2>Weather Application</h2>
        <a href="../index.html" class="navbar">Home</a>
      </div>
      <br>
      <div class="row">
      <div class="col-md-12">
      <form class="form-inline" onsubmit=" ">
          <div class="form-group">
              <label for="cityInput">City Name</label>
              <input type="text" class="form-control" id="city" name="city" placeholder="e.g Toronto">
          </div>
          <div class="form-group">
              <label for="countryInput">Country Code</label>
              <input type="text" class="form-control" id="country" name="country" placeholder="CA" maxlength="2">
         
          <label class="radio-inline">
            <input type="radio" name="unit" id="inlineRadio1" value="metric" checked="checked"> °C
          </label>
          <label class="radio-inline">
            <input type="radio" name="unit" id="inlineRadio1" value="imperial"> °F
          </label>
          </div>

          <button type="button" class="btn btn-default" id="geolocate" aria-label="Left Align">
            <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span>
          </button>
          <button type="button" class="btn btn-default" value="click" onclick="getLocation(); return false;">Submit</button>
      </form>
      </div>
      </div>
      <div id="weather-logic">
      <div class="row">
      <div class="col-md-12">
          <div id="city2"></div></div></div>
          <div class="row"><div class="col-md-6 col-md-offset-1">
          <div id="current"></div></div></div>
          <div class="row"><div class="col-md-6 col-md-offset-1">
          <div id="weather-icon"></div></div></div>
          <div class="row"><div class="col-md-6 col-md-offset-1">
          <div id="description"></div></div></div>
          <h3 id="forcast-hours"></h3>
          <div class="row">
            <div class="col-md-3 col-xs-6"><div id="3hr"></div></div>
            <div class="col-md-3 col-xs-6"><div id="6hr"></div></div>
            <div class="col-md-3 col-xs-6"><div id="9hr"></div></div>
            <div class="col-md-3 col-xs-6"><div id="12hr"></div></div>
          </div>
          <h3 id="forcast-day"></h3>
          <div class="row">
            <div class="col-md-2 col-xs-4"><div id="1day"></div></div>
            <div class="col-md-2 col-xs-4"><div id="2day"></div></div>
            <div class="col-md-2 col-xs-4"><div id="3day"></div></div>
            <div class="col-md-2 col-xs-4"><div id="4day"></div></div>
            <div class="col-md-2 col-xs-4"><div id="5day"></div></div>
    
      </div>
      </div>
      </div><!--container closed  -->
<script>
    //geolocation on button press
    var startPos;
    var city;
    var country;
    var forcast;
    var unit;
    document.getElementById("geolocate").onclick = function () {
        var geoSuccess = function (position) {
            startPos = position;
            //console.log(startPos.coords.longitude);
            lookupCoord(startPos.coords.longitude, startPos.coords.latitude);
        };
        var geoError = function (error) {
            console.log('Error occurred. Error code: ' + error.code);
        };
        navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
    };

    //get location from form and submit to OpenWeather via API
    function getLocation() {
        city = document.getElementById("city").value;
        country = document.getElementById("country").value;
        unit = document.querySelector('input[name="unit"]:checked').value;
        getWeatherData(city, country, unit);
    };

    function lookupCoord(lon, lat) {
        var xmlhttp = new XMLHttpRequest();
        var degree = document.querySelector('input[name="unit"]:checked').value;
        var url = "http://api.openweathermap.org/data/2.5/forecast?lat=" + lat + "&lon=" + lon + "&units=" + degree + "&APPID=1ce0fe4be2933336e7ce364b9428b3a9";

        xmlhttp.onload = function () {
            console.log("geobutton");
            var results = JSON.parse(this.responseText);
            utilizeData(results);

        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function getWeatherData(city, country, unit) {
        var xmlhttp2 = new XMLHttpRequest();
        var url = "http://api.openweathermap.org/data/2.5/forecast?q=" + city + "," + country + "&units=" + unit + "&APPID=1ce0fe4be2933336e7ce364b9428b3a9";
        //alert(url);
        xmlhttp2.onload = function () {
            console.log("form");
            var results = JSON.parse(this.responseText);
            utilizeData(results);

        }
        xmlhttp2.open("GET", url, true);
        xmlhttp2.send(null);
        // alert("test");
    }

    function processTime() {
        var date = new Date();
        var hours = date.getHours();
        var minutes = "0" + date.getMinutes();
        var seconds = "0" + date.getSeconds();
        var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
        return formattedTime;

    }

    function utilizeData(results) {
        var location = results.city.name;
        var minTemp = results.list[0].main.temp_min;
        var maxTemp = results.list[0].main.temp_max;
        var temp = results.list[0].main.temp;
        var time = processTime(results.list[0].dt);
        var weather = results.list[0].weather.main;
        var description = results['list'][0]['weather'][0]['description'];
        var iconID = results['list'][0]['weather'][0]['icon'];
        var hr3temp = results['list'][1]['main']['temp'];
        var h3desc = results['list'][1]['weather'][0]['description'];
        var hr6temp = results['list'][2]['main']['temp'];
        var h6desc = results['list'][2]['weather'][0]['description'];
        var hr9temp = results['list'][3]['main']['temp'];
        var h9desc = results['list'][3]['weather'][0]['description'];
        var hr12temp = results['list'][4]['main']['temp'];
        var h12desc = results['list'][4]['weather'][0]['description'];
        var day1temp = results['list'][5]['main']['temp'];
        var day1desc = results['list'][5]['weather'][0]['description'];
        var day2temp = results['list'][6]['main']['temp'];
        var day2desc = results['list'][6]['weather'][0]['description'];
        var day3temp = results['list'][7]['main']['temp'];
        var day3desc = results['list'][7]['weather'][0]['description'];
        var day4temp = results['list'][8]['main']['temp'];
        var day4desc = results['list'][8]['weather'][0]['description'];
        var day5temp = results['list'][9]['main']['temp'];
        var day5desc = results['list'][9]['weather'][0]['description'];


        var weatherHTML = document.getElementById("city");
        document.getElementById("city2").innerHTML = "<h4> Weather for the City of " + location + " at " + time + "</h4>";
        var iconURL = document.getElementById("weather-icon").innerHTML = "<img src='http://openweathermap.org/img/w/" + iconID + ".png' height='105' width='105'></img>";
        var tempUnit = "";
        if (document.querySelector('input[name="unit"]:checked').value === 'imperial') tempUnit = '°F';
        else tempUnit = '°C';
        document.getElementById("current").innerHTML = "<h2>" + temp + tempUnit + "</h2>";
        document.getElementById("description").innerHTML = "<p>   " + description + "</p>";
        document.getElementById("3hr").innerHTML = "<h2>" + hr3temp + tempUnit + "</h2>" + "<p>3 Hours: " + h3desc + "</p>";
        document.getElementById("6hr").innerHTML = "<h2>" + hr6temp + tempUnit + "</h2>" + "<p>6 Hours: " + h6desc + "</p>";
        document.getElementById("9hr").innerHTML = "<h2>" + hr9temp + tempUnit + "</h2>" + "<p>9 Hours: " + h9desc + "</p>";
        document.getElementById("12hr").innerHTML = "<h2>" + hr12temp + tempUnit + "</h2>" + "<p> 12 Hours: " + h12desc + "</p>";
        document.getElementById("1day").innerHTML = "<h3>" + day1temp + tempUnit + "</h3>" + "<p>1 Day: " + day1desc + "</p>";
        document.getElementById("2day").innerHTML = "<h3>" + day2temp + tempUnit + "</h3>" + "<p>2 Days: " + day2desc + "</p>";
        document.getElementById("3day").innerHTML = "<h3>" + day3temp + tempUnit + "</h3>" + "<p>3 Days: " + day3desc + "</p>";
        document.getElementById("4day").innerHTML = "<h3>" + day4temp + tempUnit + "</h3>" + "<p>4 Days: " + day4desc + "</p>";
        document.getElementById("5day").innerHTML = "<h3>" + day4temp + tempUnit + "</h3>" + "<p>5 Days: " + day5desc + "</p>";
        document.getElementById("forcast-hours").innerHTML = "Forcast Every 3-Hours";
        document.getElementById("forcast-day").innerHTML = "5-Day Forcast";
}
</script>
</body>
</html>
